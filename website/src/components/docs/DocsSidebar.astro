---
import { getCollection } from 'astro:content';

const { currentSlug } = Astro.props;
const docsEntries = await getCollection('docs');

// Group docs by category
const categorizedDocs = docsEntries.reduce((acc, entry) => {
  const category = entry.data.category || 'Other';
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(entry);
  return acc;
}, {} as Record<string, typeof docsEntries>);

// Sort entries within each category by order
Object.keys(categorizedDocs).forEach(category => {
  categorizedDocs[category].sort((a, b) =>
    (a.data.order || 999) - (b.data.order || 999)
  );
});
---

<aside class="w-[280px] h-[calc(100vh-72px)] bg-[var(--color-bg-card-header)] sticky top-[72px] overflow-y-auto">
  <div class="flex flex-col gap-6 p-6">
    <h3 class="text-sm font-semibold text-[var(--color-text-white)]">Documentation</h3>

    {Object.entries(categorizedDocs).map(([category, entries]) => (
      <nav class="flex flex-col gap-2">
        <span class="text-[11px] font-semibold text-[var(--color-text-muted)] tracking-wider uppercase">
          {category}
        </span>
        <div class="flex flex-col gap-2">
          {entries.map(entry => (
            <a
              href={`/docs/${entry.slug}`}
              class={`px-3 py-2 rounded-md text-sm transition-colors ${
                entry.slug === currentSlug
                  ? 'bg-[var(--color-primary-muted)] text-[var(--color-primary)] font-medium'
                  : 'text-[var(--color-text-gray-light)] hover:text-[var(--color-text-white)]'
              }`}
            >
              {entry.data.title}
            </a>
          ))}
        </div>
      </nav>
    ))}
  </div>
</aside>
